<!DOCTYPE html>
<html>

<head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-click-drag-component"></script>
    <script src="./src/user-control.js"></script>
</head>

<body>

    <div class="stinky" style="color: blue">press wasd to move</div>
    <button style="z-index: 2; position: absolute;" type="button" onclick="testFunc()">Click Me!</button>
    <div class="square"></div>
    <div id='aframe-wrapper'>
        <a-scene id="scene" renderer="colorManagement: true; antialias: false">
            <a-assets>
                <a-asset-item position="-1 0.5 -2" id="tree" src="./chi.glb"></a-asset-item>
                <a-asset-item position="-1 0.5 -3" id="chi" src="./lowspecchi.glb"></a-asset-item>
                <a-asset-item position="0 0 0" id="floorbear" src="./planeglb.glb"></a-asset-item>
            </a-assets>
            <a-entity camera universal-controls look-controls="pointerLockEnabled: true" wasd-controls kinematic-body
                raycaster="far: 2" jump-ability position="0 1.6 0">
                <a-entity raycaster="objects: .clickable" cursor="fuse: true" position="0 0 -.1" scale=".001 .001 .001"
                    geometry="primitive: ring" color="grey"></a-entity>
            </a-entity>

            <a-box class="clickable" id="box" color="#EF2D5E" position="0 1 -4" change-color-on-hover
            raycaster="far: 9"></a-box>
    
          <a-entity id="chi2" position="-0.02919 1.241 -1.38241" scale="0.43549 0.52011 0.42498" gltf-model="#chi" visible="true" unlit clicker
            flatShading="true"></a-entity>
    
          <a-entity class="clickable" id="chi2" change-color-on-hover position="1 2 -2" scale="0.10 .10 .10" gltf-model="#chi" visible="true"
            flatShading="true" raycaster="far: 9"></a-entity>
    
          <a-entity position="0 .5 0" gltf-model="#floorbear" scale="1 1 1"></a-entity>
    
          <a-plane position="0 -1 -7" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
        </a-scene>
    </div>

    <script>
        AFRAME.registerComponent('unlit', {

            init: function () {

                function recursivelySetChildrenUnlit(mesh) {

                    if (mesh.material && mesh.material.map) {
                        mesh.material = new THREE.MeshBasicMaterial({ map: mesh.material.map });
                    }

                    if (mesh.children) {
                        for (var i = 0; i < mesh.children.length; i++) {
                            recursivelySetChildrenUnlit(mesh.children[i]);
                        }
                    }
                }

                this.el.addEventListener('model-loaded', (e) => {

                    const mesh = e.target.getObject3D('mesh');
                    for (var i = 0; i < mesh.children.length; i++) {
                        recursivelySetChildrenUnlit(mesh.children[i]);
                    }

                });
            }
        });
    </script>
</body>

</html>